name: Deploy Helm Chart

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      # 1. Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Setup Helm (if not installed on runner)
      - name: Setup Helm
        uses: azure/setup-helm@v3
        with:
          version: v3.18.2

      # 3. Deploy the chart
      - name: Deploy app1 Helm chart
        shell: pwsh
        run: |
          # Go to the repo root
          cd $env:GITHUB_WORKSPACE
          
          # Debug: list files for confirmation
          Write-Host "Current folder: $(Get-Location)"
          Write-Host "Folder content: $(Get-ChildItem | ForEach-Object { $_.Name })"

          # Deploy Helm chart
          helm upgrade --install app1 ./app1 \
            --namespace default \
            --create-namespace \
            --values ./app1/values.yaml
